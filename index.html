<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NZ Occupation Rates Monitor 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .card { transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .source-link { color: #3b82f6; text-decoration: none; }
        .source-link:hover { text-decoration: underline; }
    </style>
</head>
<body class="text-gray-800 flex flex-col min-h-screen">

    <!-- Navigation Bar -->
    <nav class="bg-slate-900 text-white shadow-lg">
        <div class="container mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-chart-line text-2xl text-blue-400"></i>
                <h1 class="text-2xl font-bold">NZ Occupation Monitor</h1>
            </div>
            
            <!-- Dynamic Status Badge -->
            <div id="statusBadge" class="flex items-center space-x-2 bg-slate-800 px-4 py-2 rounded-full border border-slate-700">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </span>
                <span class="text-sm font-medium" id="lastUpdatedText">Checking status...</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8 flex-grow">

        <!-- Header -->
        <div class="mb-8 text-center">
            <h2 class="text-3xl font-bold text-gray-900">Market Intelligence Dashboard</h2>
            <p class="text-gray-600 mt-2">Aggregated insights on employment trends and sector growth.</p>
        </div>

        <!-- Key Metrics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Unemployment -->
            <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500 card">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">UNEMPLOYMENT RATE</p>
                        <h3 class="text-3xl font-bold text-gray-800" id="stat-unemployment">--%</h3>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-full text-blue-600"><i class="fa-solid fa-users-slash"></i></div>
                </div>
                <p class="text-xs mt-2" id="trend-unemployment">Loading...</p>
            </div>

            <!-- Employment -->
            <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500 card">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">EMPLOYMENT RATE</p>
                        <h3 class="text-3xl font-bold text-gray-800" id="stat-employment">--%</h3>
                    </div>
                    <div class="bg-green-50 p-3 rounded-full text-green-600"><i class="fa-solid fa-briefcase"></i></div>
                </div>
                <p class="text-xs mt-2" id="trend-employment">Loading...</p>
            </div>

            <!-- Highest Growth -->
            <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-purple-500 card">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">TOP GROWTH SECTOR</p>
                        <h3 class="text-xl font-bold text-gray-800 truncate" id="stat-growth-name">--</h3>
                    </div>
                    <div class="bg-purple-50 p-3 rounded-full text-purple-600"><i class="fa-solid fa-rocket"></i></div>
                </div>
                <p class="text-xs text-green-500 mt-2 font-bold" id="stat-growth-val">Loading...</p>
            </div>

            <!-- Declining -->
             <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-orange-500 card">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm font-semibold">HARDEST HIT SECTOR</p>
                        <h3 class="text-xl font-bold text-gray-800 truncate" id="stat-decline-name">--</h3>
                    </div>
                    <div class="bg-orange-50 p-3 rounded-full text-orange-600"><i class="fa-solid fa-arrow-trend-down"></i></div>
                </div>
                <p class="text-xs text-red-500 mt-2 font-bold" id="stat-decline-val">Loading...</p>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Industry Growth (YoY %)</h3>
                <canvas id="growthChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Unemployment Forecast</h3>
                <canvas id="unemploymentChart"></canvas>
            </div>
        </div>

        <!-- Detailed Data Table -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
            <div class="p-6 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4 bg-gray-50">
                <h3 class="text-xl font-bold text-gray-800">Sector Breakdown</h3>
                <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Search occupation..." class="border border-gray-300 rounded-md px-4 py-2 w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-white text-gray-600 uppercase text-xs font-bold tracking-wider">
                            <th class="py-4 px-6 border-b">Occupation / Industry</th>
                            <th class="py-4 px-6 border-b">Trend</th>
                            <th class="py-4 px-6 border-b">Growth</th>
                            <th class="py-4 px-6 border-b">Market Status</th>
                            <th class="py-4 px-6 border-b">Avg Earnings</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-600 text-sm font-light bg-white" id="occupationTableBody">
                        <!-- Data inserted via JS -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Data Methodology & Sources Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto">
        <div class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-sm">
                
                <!-- Column 1: Methodology -->
                <div>
                    <h4 class="font-bold text-gray-900 mb-3 uppercase tracking-wide">Methodology</h4>
                    <p class="text-gray-600 leading-relaxed">
                        This dashboard aggregates data from open government datasets and simulates real-time market fluctuations for demonstration purposes. 
                        Updates occur daily at 08:00 NZT via automated GitHub Actions.
                    </p>
                </div>

                <!-- Column 2: Data Sources -->
                <div>
                    <h4 class="font-bold text-gray-900 mb-3 uppercase tracking-wide">Primary Data Sources</h4>
                    <ul class="space-y-2 text-gray-600">
                        <li><i class="fa-solid fa-building-columns w-5 text-gray-400"></i> <a href="https://www.stats.govt.nz" target="_blank" class="source-link">Stats NZ (Labour Market Statistics)</a></li>
                        <li><i class="fa-solid fa-briefcase w-5 text-gray-400"></i> <a href="https://www.mbie.govt.nz" target="_blank" class="source-link">MBIE (Jobs Online Report)</a></li>
                        <li><i class="fa-solid fa-globe w-5 text-gray-400"></i> <a href="#" class="source-link">Seek / Trade Me (Aggregated Trends)</a></li>
                    </ul>
                </div>

                <!-- Column 3: Disclaimer -->
                <div>
                    <h4 class="font-bold text-gray-900 mb-3 uppercase tracking-wide">Disclaimer</h4>
                    <p class="text-gray-500 text-xs leading-relaxed">
                        This tool is for educational and evaluation purposes. While data mimics real-world trends, specific figures may be simulated. 
                        Always consult official government releases for critical financial or policy decisions.
                    </p>
                    <div class="mt-4 pt-4 border-t border-gray-100 text-xs text-gray-400">
                        &copy; 2025 Occupation Monitor. <a href="data.json" class="underline">View Raw JSON</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        async function loadData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) throw new Error("Failed to load");
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error(error);
                document.getElementById('lastUpdatedText').innerHTML = 'Error loading data';
                document.getElementById('statusBadge').classList.add('bg-red-900');
            }
        }

        function updateDashboard(data) {
            // Update "Live" Badge
            const dateStr = data.meta.last_updated;
            document.getElementById('lastUpdatedText').innerHTML = `Data Updated: ${dateStr}`;

            // Update Metrics
            document.getElementById('stat-unemployment').innerText = data.stats.unemployment_rate + '%';
            
            // Unemployment Trend Logic
            const uTrend = data.stats.unemployment_trend;
            const uEl = document.getElementById('trend-unemployment');
            uEl.innerHTML = `<i class="fa-solid ${uTrend > 0 ? 'fa-arrow-trend-up' : 'fa-arrow-trend-down'}"></i> ${uTrend > 0 ? '+' : ''}${uTrend}% vs last quarter`;
            uEl.className = uTrend > 0 ? "text-xs text-red-600 mt-2 font-bold" : "text-xs text-green-600 mt-2 font-bold";

            document.getElementById('stat-employment').innerText = data.stats.employment_rate + '%';
            document.getElementById('trend-employment').innerText = "Stable (Seasonally Adjusted)";
            
            // Find Top/Bottom Growth
            const sorted = [...data.industries].sort((a,b) => b.growth_rate - a.growth_rate);
            const best = sorted[0];
            const worst = sorted[sorted.length - 1];

            document.getElementById('stat-growth-name').innerText = best.name;
            document.getElementById('stat-growth-val').innerText = `+${best.growth_rate}% Annual Growth`;
            
            document.getElementById('stat-decline-name').innerText = worst.name;
            document.getElementById('stat-decline-val').innerText = `${worst.growth_rate}% Annual Decline`;

            // Populate Table
            const tbody = document.getElementById('occupationTableBody');
            tbody.innerHTML = '';
            data.industries.forEach(ind => {
                let iconClass = ind.trend_direction === 'up' ? 'fa-arrow-up text-green-500' : 
                               (ind.trend_direction === 'down' ? 'fa-arrow-down text-red-500' : 'fa-minus text-gray-400');
                
                let statusStyle = ind.status.includes('High') || ind.status.includes('Growing') ? 'bg-green-100 text-green-800 border-green-200' : 
                                  (ind.status.includes('Contracting') ? 'bg-red-100 text-red-800 border-red-200' : 'bg-blue-100 text-blue-800 border-blue-200');

                let row = `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                        <td class="py-4 px-6 font-medium text-gray-900">${ind.name}</td>
                        <td class="py-4 px-6"><i class="fa-solid ${iconClass}"></i></td>
                        <td class="py-4 px-6 font-bold ${ind.growth_rate > 0 ? 'text-green-600' : 'text-red-600'}">
                            ${ind.growth_rate > 0 ? '+' : ''}${ind.growth_rate}%
                        </td>
                        <td class="py-4 px-6">
                            <span class="${statusStyle} py-1 px-3 rounded-full text-xs font-semibold border">${ind.status}</span>
                        </td>
                        <td class="py-4 px-6 text-gray-600">$${ind.earnings.toFixed(2)}</td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });

            initCharts(data);
        }

        function initCharts(data) {
            // Growth Chart
            new Chart(document.getElementById('growthChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: data.industries.map(i => i.name),
                    datasets: [{
                        label: 'Growth Rate (%)',
                        data: data.industries.map(i => i.growth_rate),
                        backgroundColor: data.industries.map(i => i.growth_rate >= 0 ? '#4ade80' : '#f87171'),
                        borderRadius: 4
                    }]
                },
                options: { 
                    responsive: true, 
                    plugins: { legend: { display: false } },
                    scales: { y: { grid: { display: false } } }
                }
            });

            // Unemployment Chart
            new Chart(document.getElementById('unemploymentChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Dec', 'Mar', 'Jun', 'Sep', 'Forecast'],
                    datasets: [{
                        label: 'Unemployment Rate',
                        data: [5.1, 5.1, 5.2, 5.3, data.stats.unemployment_rate],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { responsive: true }
            });
        }

        function filterTable() {
            const filter = document.getElementById("searchInput").value.toUpperCase();
            const rows = document.getElementById("occupationTableBody").getElementsByTagName("tr");
            for (let row of rows) {
                const txt = row.cells[0].textContent || row.cells[0].innerText;
                row.style.display = txt.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }

        loadData();
    </script>
</body>
</html>
